# This docker-compose file will set up Elastic APM, Kibana and Elasticsearch containers
# and the apm-server.yml configuration file ensures that APM can talk to Kibana. Once
# the servers are up and running you should be able to browse http://localhost:5601
# and see Kibana running.
# In order to set up the APM dashboards, you will need to run the `./apm-server -setup`
# command on the running apm-server container:
# $ docker-compose up -d
#   Starting elasticsearch_1 ... done
#   Starting kibana_1 ... done
#   Starting apm-server_1 ... done
# $ docker-compose exec apm-server ./apm-server setup
#   Loaded index template
#   Loaded dashboards
# 
# You should now be able to browse http://localhost:5601 and see the APM dashboards in Kibana.

# https://blog.csdn.net/CalledJoker/article/details/122972170
# https://stackoverflow.com/questions/71492404/elasticsearch-showing-received-plaintext-http-traffic-on-an-https-channel-in-con
# https://www.cnblogs.com/chenyuanbo/p/16183304.html
# https://www.cnblogs.com/feifei6779/p/16524927.html
# https://blog.csdn.net/IT_road_qxc/article/details/121858843
# https://www.elastic.co/guide/en/apm/guide/current/configuration-rum.html
# https://www.elastic.co/guide/en/apm/agent/rum-js/current/angular-integration.html
# https://www.elastic.co/guide/en/apm/guide/current/source-map-how-to.html
# https://angular.cn/guide/workspace-config#complex-configuration-values

version: "3"
services:
    elasticsearch:
      image: elasticsearch:8.11.0
      ports:
        - "9200:9200"
        - "9300:9300"
      environment:
        - discovery.type=single-node
        - xpack.security.enabled=true
        - ELASTIC_PASSWORD=pass1223
    kibana:
      image: kibana:8.11.0
      ports:
        - "5601:5601"
      links:
        - elasticsearch
      depends_on:
        - elasticsearch
      environment:
        - ELASTICSEARCH_HOSTS=http://elasticsearch:9200 #设置访问elasticsearch的地址
        - I18N_LOCALE=zh-CN
        - ELASTICSEARCH_USERNAME=logadmin
        - ELASTICSEARCH_PASSWORD="123456"
    apm-server:
      image: elastic/apm-server:8.11.0
      ports:
        - "8200:8200"
      volumes:
        - ./.apm-server.yml:/usr/share/apm-server/apm-server.yml
      depends_on:
        - elasticsearch
      links:
        - elasticsearch
        - kibana
